---
title: Mutation Operations
description: Learn about create, update, and delete operations in Drizzle Service.
---

import { Banner } from 'fumadocs-ui/components/banner'
import { CodeBlock } from 'fumadocs-ui/components/codeblock'
import { Step, Steps } from 'fumadocs-ui/components/steps'
import { Tab, Tabs } from 'fumadocs-ui/components/tabs'
import { TypeTable } from 'fumadocs-ui/components/type-table'


Drizzle Service provides powerful mutation operations for creating, updating, and deleting records. All operations support lifecycle hooks, validation, and consistent error handling.

## Create Operations

### create()

  Creates a new entity in the database with optional validation and lifecycle hooks.

  ### Method Signature

  ```typescript
  create: (
    data: T['$inferInsert'],
    hooks?: ServiceHooks<T>,
  ) => Handler<T['$inferSelect']>
  ```

  ### Parameters

  <TypeTable
    type={{
      data: {
        description: 'The data to insert, conforming to the entity\'s insert schema.',
        type: 'T["$inferInsert"]'
      },
      hooks: {
        description: 'Optional service hooks to execute during creation.',
        type: 'ServiceHooks<T>',
        default: 'undefined'
      }
    }}
  />

  ### Return Type

  <TypeTable
    type={{
      Handler: {
        description: 'Promise that resolves to either an error or the created entity.',
        type: 'Promise<[Error, null] | [null, T["$inferSelect"]]>'
      }
    }}
  />


## Update Operations

### update()

  Updates an existing entity by its identifier with optional validation and lifecycle hooks.

  ### Method Signature

  ```typescript
  update: (
    id: IdType<T, TOpts>,
    data: Partial<Omit<T['$inferInsert'], 'createdAt' | 'id'>>,
    hooks?: ServiceHooks<T>,
  ) => Handler<T['$inferSelect']>
  ```

  ### Parameters

  <TypeTable
    type={{
      id: {
        description: 'The identifier of the entity to update.',
        type: 'IdType<T, TOpts>'
      },
      data: {
        description: 'Partial data to update, excluding createdAt and id fields.',
        type: 'Partial<Omit<T["$inferInsert"], "createdAt" | "id">>'
      },
      hooks: {
        description: 'Optional service hooks to execute during update.',
        type: 'ServiceHooks<T>',
        default: 'undefined'
      }
    }}
  />

  ### Return Type

  <TypeTable
    type={{
      Handler: {
        description: 'Promise that resolves to either an error or the updated entity.',
        type: 'Promise<[Error, null] | [null, T["$inferSelect"]]>'
      }
    }}
  />


## Delete Operations

Drizzle Service supports both soft and hard deletes, depending on your configuration.

### delete()

  Performs a soft delete on an entity (marks as deleted without removing from database).

  ### Method Signature

  ```typescript
  delete: (
    id: IdType<T, TOpts>,
    hooks?: ServiceHooks<T>,
  ) => Promise<{ readonly success: boolean; readonly message?: string }>
  ```

  ### Parameters

  <TypeTable
    type={{
      id: {
        description: 'The identifier of the entity to soft delete.',
        type: 'IdType<T, TOpts>'
      },
      hooks: {
        description: 'Optional service hooks to execute during deletion.',
        type: 'ServiceHooks<T>',
        default: 'undefined'
      }
    }}
  />

  ### Return Type

  <TypeTable
    type={{
      success: {
        description: 'Boolean indicating if the operation was successful.',
        type: 'boolean'
      },
      message: {
        description: 'Optional descriptive message about the operation result.',
        type: 'string',
        default: 'undefined'
      }
    }}
  />

  ## hardDelete()

  Permanently removes an entity from the database.

  ### Method Signature

  ```typescript
  hardDelete: (
    id: IdType<T, TOpts>,
    hooks?: ServiceHooks<T>,
  ) => Promise<{ readonly success: boolean; readonly message?: string }>
  ```

  ### Parameters

  <TypeTable
    type={{
      id: {
        description: 'The identifier of the entity to permanently delete.',
        type: 'IdType<T, TOpts>'
      },
      hooks: {
        description: 'Optional service hooks to execute during hard deletion.',
        type: 'ServiceHooks<T>',
        default: 'undefined'
      }
    }}
  />

## Restore Operations

### restore()

  Restores a soft-deleted entity by its identifier.

  ### Method Signature

  ```typescript
  restore: (
    id: IdType<T, TOpts>,
    hooks?: ServiceHooks<T>,
  ) => Promise<{ readonly success: boolean; readonly message?: string }>
  ```

  ### Parameters

  <TypeTable
    type={{
      id: {
        description: 'The identifier of the entity to restore.',
        type: 'IdType<T, TOpts>'
      },
      hooks: {
        description: 'Optional service hooks to execute during restoration.',
        type: 'ServiceHooks<T>',
        default: 'undefined'
      }
    }}
  />

  ### Return Type

  <TypeTable
    type={{
      success: {
        description: 'Boolean indicating if the operation was successful.',
        type: 'boolean'
      },
      message: {
        description: 'Optional descriptive message about the operation result.',
        type: 'string',
        default: 'undefined'
      }
    }}
  />

## Error Handling

### Handler Pattern

  All mutation operations return a `Handler<T>` type for consistent error handling.

  ### Handler Type

  <TypeTable
    type={{
      Handler: {
        description: 'Promise that resolves to either an error tuple or success tuple.',
        type: 'Promise<[Error, null] | [null, T]>'
      }
    }}
  />

  ### Error Tuple Structure

  <TypeTable
    type={{
      'Error Case': {
        description: 'When operation fails, returns error in first position.',
        type: '[Error, null]'
      },
      'Success Case': {
        description: 'When operation succeeds, returns result in second position.',
        type: '[null, T]'
      }
    }}
  />

## Configuration Types

### ServiceHooks

All mutation operations support lifecycle hooks for custom logic execution.

<TypeTable
type={{
  beforeAction: {
    description: 'Execute custom logic before the database operation.',
    type: '(data: T["$inferSelect"]) => Promise<void>',
    default: 'undefined'
  },
  afterAction: {
    description: 'Execute custom logic after successful database operation.',
    type: '(data: T["$inferSelect"]) => Promise<void>',
    default: 'undefined'
  },
  onError: {
    description: 'Execute custom error handling when operation fails.',
    type: '(error: Error) => Promise<void>',
    default: 'undefined'
  }
}}
/>

### Hook Execution Order

<Steps>

  <Step>
    **beforeAction** hook
    
    Pre-processing logic, additional validation, or setup operations.
  </Step>

  <Step>
    **Database operation**
    
    The actual create, update, or delete operation is performed.
  </Step>

  <Step>
    **afterAction** hook (on success)
    
    Post-processing logic, notifications, or cleanup operations.
  </Step>

  <Step>
    **onError** hook (on failure)
    
    Error handling, logging, or rollback operations.
  </Step>
</Steps>

### Soft Delete Configuration

Configure soft delete behavior in service options:

<TypeTable
  type={{
    field: {
      description: 'Field name used to mark records as deleted.',
      type: 'keyof T["$inferSelect"]',
      required: true
    },
    deletedValue: {
      description: 'Value to set when marking a record as deleted.',
      type: 'T["$inferSelect"][keyof T["$inferSelect"]]',
      required: true
    }
  }}
/>
